const project_id=document.getElementById("project-id").value,page_domain_id=document.getElementById("domain-id").value;let findings_chart;const subdomainsAction=async event=>{const id=event.currentTarget.parent("tr").dataset.domainId;location.href=`/domain/${id}`},toggleDomain=async toggleEl=>{const toggleIconEl=toggleEl.querySelector("i"),domain_id="toggle-domain"==toggleEl.id?document.getElementById("domain-id").value:toggleEl.parent("tr").dataset.domainId;let action="enable-domain",classNameAlt="icofont-toggle-on";toggleIconEl.classList.contains("icofont-toggle-on")&&(classNameAlt="icofont-toggle-off",action="disable-domain");const json=await Api.post_async(`/v1/${action}`,{domain_id:domain_id}).catch((()=>{toast("error","An unexpected error occurred. Please refresh the page and try again.")}));return"success"!=json.status?(toast(json.status,json.message),json):(toggleIconEl.classList.remove(toggleIconEl.className),toggleIconEl.classList.add(classNameAlt),toggleEl.title="disable-domain"==action?"Enable domain monitoring":"Disable domain monitoring",json)},deleteDomain=async domain_id=>{const json=await PublicApi.post({target:"/domain/delete",body:{domain_id:domain_id}});return toast(json.status,json.message),json},toggleDomainAction=async()=>{await toggleDomain(document.getElementById("toggle-domain"))},toggleDomainRowAction=async event=>{await toggleDomain(event.currentTarget)},deleteDomainAction=async()=>{await deleteDomain(page_domain_id)},deleteDomainRowAction=async event=>{const domainRow=event.currentTarget.parent("tr"),domain_id=domainRow.dataset.domainId,json=await deleteDomain(domain_id);toast(json.status,json.message),domainRow.remove()},runDomainAction=async event=>{const action=document.getElementById("scan-action").value,json=await Api.post_async(`/v1/${action}`,{domain_id:page_domain_id}).catch((()=>{toast("error","An unexpected error occurred. Please refresh the page and try again.")}));toast(json.status,json.message)},handleSocket=async data=>{console.debug(data)};document.addEventListener("DOMContentLoaded",(async()=>{app.websocket.on("update_job_state",handleSocket),app.websocket.on("dns_changes",handleSocket),app.websocket.on("domain_changes",handleSocket),app.websocket.on("check_domains_tld",handleSocket);const barCanvasEl=document.querySelector(".bar-canvas canvas");barCanvasEl&&(findings_chart=new Chart(barCanvasEl.getContext("2d"),{type:"bar",data:findings_chart_config,options:{indexAxis:"y",scales:{xAxes:[{ticks:{beginAtZero:!0}}]},layout:{padding:{left:0,right:50,top:0,bottom:0}},font:{color:"#e6e6e6"}}}));const toggleActionEl=document.getElementById("toggle-domain");toggleActionEl&&(toggleActionEl.addEventListener("click",toggleDomainAction,!1),toggleActionEl.addEventListener("touchstart",toggleDomainAction,!!supportsPassive&&{passive:!0}));const deleteActionEl=document.getElementById("delete-domain");deleteActionEl.addEventListener("click",deleteDomainAction,!1),deleteActionEl.addEventListener("touchstart",deleteDomainAction,!!supportsPassive&&{passive:!0});const runActionEl=document.getElementById("run-action");runActionEl.addEventListener("click",runDomainAction,!1),runActionEl.addEventListener("touchstart",runDomainAction,!!supportsPassive&&{passive:!0});for await(const domainEl of document.querySelectorAll(".domains-list td.click-through")){domainEl.parent(".disabled-events")||(domainEl.addEventListener("click",subdomainsAction,!1),domainEl.addEventListener("touchstart",subdomainsAction,!!supportsPassive&&{passive:!0}))}for await(const domainEl of document.querySelectorAll(".domains-list td.toggle-monitoring"))domainEl.addEventListener("click",toggleDomainRowAction,!1),domainEl.addEventListener("touchstart",toggleDomainRowAction,!!supportsPassive&&{passive:!0});for await(const domainEl of document.querySelectorAll(".domains-list td.delete-domain"))domainEl.addEventListener("click",deleteDomainRowAction,!1),domainEl.addEventListener("touchstart",deleteDomainRowAction,!!supportsPassive&&{passive:!0})}),!1);