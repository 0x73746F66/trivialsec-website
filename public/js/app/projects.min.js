const init_projects=async()=>{app.websocket.on("update_job_state",handleSocket),app.websocket.on("dns_changes",handleSocket),app.websocket.on("domain_changes",handleSocket),app.websocket.on("check_domains_tld",handleSocket);const createEl=document.getElementById("create_project_input");createEl.addEventListener("click",createProject,!1),createEl.addEventListener("touchstart",createProject,!!supportsPassive&&{passive:!0}),document.getElementById("domain_name_input").addEventListener("keyup",(async event=>13==event.keyCode?createProject(event):0),!1);for await(const projectsEl of document.querySelectorAll(".projects-list tr"))projectsEl.addEventListener("click",projectsAction,!1),projectsEl.addEventListener("touchstart",projectsAction,!!supportsPassive&&{passive:!0})},projectsAction=async event=>{const project_id=event.currentTarget.parent("tr").dataset.projectId;location.href=`/project/${project_id}`},handleSocket=async data=>{console.debug(data)},createProject=async event=>{const project_name=document.getElementById("project_name_input").value,domain_name=document.getElementById("domain_name_input").value,json=await PublicApi.post({target:"/create-project",body:{project_name:project_name,domain_name:domain_name}});if(toast(json.status,json.message),json.domain){document.querySelector("#projects-list caption").textContent="Projects";const project_id=json.domain.project_id,tr=document.querySelector(`[data-project-id="${project_id}"]`);if(tr){const domainsEl=tr.querySelector('[title="Domains"] div');domainsEl.textContent=parseInt(domainsEl.textContent)+1}else{const template_raw=document.getElementById("tmpl-project-row");if(!template_raw)return void toast("warning","Project template not found");const container=document.querySelector(".projects-list tbody"),template=micromustache.render(htmlDecode(template_raw.innerHTML),{project_id:project_id,project_name:project_name});container.insertAdjacentHTML("beforeend",template);const row=document.querySelector(`tr[data-project-id="${project_id}"]`);row.addEventListener("click",projectsAction,!1),row.addEventListener("touchstart",projectsAction,!!supportsPassive&&{passive:!0})}}};document.addEventListener("DOMContentLoaded",init_projects,!1);