const saveFields=async()=>{const recaptcha_token=document.getElementById("recaptcha_token").value,confirmation_url=document.getElementById("confirmation_url").value,password1=document.getElementById("new_password").value,password2=document.getElementById("repeat_password").value;if(password1!=password2)return void appMessage("error","Passwords do not match");const response=await fetch("/change-password",{credentials:"same-origin",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recaptcha_token:recaptcha_token,confirmation_url:confirmation_url,password1:password1,password2:password2})}).catch((err=>{appMessage("error","An unexpected error occurred. Please refresh the page and try again."),console.log(err)})),json=await response.json();json.status&&"error"==json.status&&(appMessage(json.status,json.message),console.log(json),refresh_recaptcha_token("password_reset_action")),json.status&&"success"==json.status&&(appMessage(json.status,json.message),setTimeout((()=>{window.location.href="/login"}),5e3))};app.recaptchaSiteKey&&grecaptcha.ready((()=>{refresh_recaptcha_token("password_reset_action")})),document.addEventListener("DOMContentLoaded",(()=>{"/password-reset"!=location.pathname&&history.pushState({},document.title,"/password-reset");const el=document.getElementById("save_password");el.addEventListener("click",saveFields,!1),el.addEventListener("touchstart",saveFields,!!supportsPassive&&{passive:!0})}),!1);