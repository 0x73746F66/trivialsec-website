const chooseMethod=async event=>{if("choose-method"!=event.currentTarget.id)return void toast("warning","This feature is not currently available","Sorry");const methodTypeArr=Array.from(document.getElementsByName("recoveryType")).filter((e=>e.checked)),methodType=1==methodTypeArr.length?methodTypeArr.pop().value:null;"scratch"==methodType&&(document.querySelector(".recoveryCard__card.choose-method").classList.add("hide"),document.querySelector(".recoveryCard__card.confirm-scratch").classList.remove("hide")),"email"==methodType&&(document.querySelector(".recoveryCard__card.choose-method").classList.add("hide"),document.querySelector(".recoveryCard__card.request-email").classList.remove("hide"))},recoverScratch=async event=>{const scratch_code=document.getElementById("scratch-code").value,json=await PublicApi.post({target:"/recovery/scratch",body:{recaptcha_token:recaptcha_token,scratch_code:scratch_code},sign:!1});if(json.status&&"success"==json.status){const successEl=document.querySelector(".confirm-scratch .success-checkmark_off");successEl.classList.remove("success-checkmark_off"),successEl.classList.remove("hide"),successEl.classList.add("success-checkmark");for(const elem of document.querySelectorAll(".recovery__fieldset"))elem.classList.add("invisible");document.getElementById("recover-scratch").remove();const messageEl=document.getElementById("scratch-message");messageEl.classList.remove("hide"),messageEl.textContent=json.message}},recoverEmail=async event=>{const old_email=document.getElementById("old-email").value,new_email=document.getElementById("new-email").value,json=await PublicApi.post({target:"/recovery/email",body:{recaptcha_token:recaptcha_token,old_email:old_email,new_email:new_email},sign:!1});if(json.status&&"success"==json.status){const successEl=document.querySelector(".request-email .success-checkmark_off");successEl.classList.remove("success-checkmark_off"),successEl.classList.remove("hide"),successEl.classList.add("success-checkmark");for(const elem of document.querySelectorAll(".recovery__fieldset"))elem.classList.add("hide");document.querySelector(".recovery__subheader.request").remove(),document.getElementById("recover-email").remove();const messageEl=document.getElementById("recovery-message");messageEl.classList.remove("hide"),messageEl.textContent=json.message}},check_scratch_code=async event=>{event.preventDefault();const input=event.currentTarget.value;if(!input)return;if(input.length>=28)return void(event.currentTarget.value=input.substring(0,27));let newChar=Array.from(input).pop();if("-"===newChar||" "===newChar)return;let prevString=Array.from(input);prevString.pop(),"string"==typeof newChar&&(newChar=newChar.toUpperCase());let newInput=prevString.join("")+newChar;4!==newInput.length&&11!==newInput.length&&20!==newInput.length||(newInput+="-"),event.currentTarget.value=newInput},handle_scratch_paste=async event=>{event.stopPropagation(),event.preventDefault();const scratch_code=(event.clipboardData||window.clipboardData).getData("Text");if(!scratch_code)return;const arr=Array.from(scratch_code);"-"===arr[4]&&"-"===arr[11]&&"-"===arr[20]&&(document.getElementById("scratch-code").value=scratch_code.toUpperCase())};grecaptcha.ready((()=>{init_recaptcha("recovery_action")})),document.addEventListener("DOMContentLoaded",(async()=>{const chooseMethodEl=document.getElementById("choose-method");chooseMethodEl&&(chooseMethodEl.addEventListener("click",chooseMethod,!1),chooseMethodEl.addEventListener("touchstart",chooseMethod,!!supportsPassive&&{passive:!0}));const recoverScratchEl=document.getElementById("recover-scratch");recoverScratchEl&&(recoverScratchEl.addEventListener("click",recoverScratch,!1),recoverScratchEl.addEventListener("touchstart",recoverScratch,!!supportsPassive&&{passive:!0}));const recoverEmailEl=document.getElementById("recover-email");recoverEmailEl&&(recoverEmailEl.addEventListener("click",recoverEmail,!1),recoverEmailEl.addEventListener("touchstart",recoverEmail,!!supportsPassive&&{passive:!0}));const scratchCodeEl=document.getElementById("scratch-code");scratchCodeEl.addEventListener("input",check_scratch_code,!1),scratchCodeEl.addEventListener("paste",handle_scratch_paste,!1)}),!1);