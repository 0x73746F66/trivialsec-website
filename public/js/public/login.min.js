let tabWrapper=document.querySelector(".tab__content"),activeTab=tabWrapper.querySelector(".active");const eventTabSwitch=async e=>{for await(const ele of document.querySelectorAll(".tabs > li"))ele.classList.remove("active");e.currentTarget.classList.add("active"),activeTab.querySelector(".content__wrapper").classList.add("hide"),activeTab.querySelector(".content__wrapper").classList.remove("show");for await(const ele of document.querySelectorAll(".tab__content > li"))ele.classList.remove("active");document.querySelector(`.tab__content [data-tab="${e.currentTarget.dataset.tab}"]`).classList.add("active"),activeTab=document.querySelector(".tab__content > .active");let activeTabHeight=activeTab.offsetHeight;for await(const ele of document.querySelectorAll(".tab__content"))ele.querySelector(".active")==activeTab&&(ele.style.height=activeTabHeight);activeTab.querySelector(".content__wrapper").classList.remove("hide"),activeTab.querySelector(".content__wrapper").classList.add("show")};app.recaptchaSiteKey&&grecaptcha.ready((()=>{refresh_recaptcha_token("login_action")}));const password_reset_action=async(event,retry_count=0)=>{0===retry_count&&event.preventDefault();const token=document.getElementById("recaptcha_token").value,response=await fetch("/password-reset",{credentials:"same-origin",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recaptcha_token:token,email:document.getElementById("email").value})}).catch((err=>{appMessage("error","An unexpected error occurred. Please refresh the page and try again."),console.log(err)})),json=await response.json();if(json){if(appMessage(json.status,json.message),"retry"==json.status)return refresh_recaptcha_token("login_action"),void await password_reset_action(event,++retry_count);"success"==json.status&&(document.querySelector('[data-tab="login"]').click(),document.getElementById("login_email").value=json.email)}refresh_recaptcha_token("login_action")},login_action=async(event,retry_count=0)=>{0===retry_count&&event.preventDefault();const login_email=document.getElementById("login_email").value,login_password=document.getElementById("password").value;if(!login_password||!login_email)return;const token=document.getElementById("recaptcha_token").value,response=await fetch("/login",{credentials:"same-origin",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recaptcha_token:token,email:login_email,password:login_password})}).catch((err=>{appMessage("error","An unexpected error occurred. Please refresh the page and try again."),console.log(err)})),json=await response.json();if(json){if(appMessage(json.status,json.message),"retry"==json.status)return refresh_recaptcha_token("login_action"),void await login_action(event,++retry_count);"success"==json.status&&(localStorage.setItem("hmac-secret",json.hmac_secret),window.location.href=json.is_setup?"/":"/account/setup/1")}refresh_recaptcha_token("login_action")};document.addEventListener("DOMContentLoaded",(async()=>{"/login"!=location.pathname&&history.pushState({},document.title,"/login");let activeTabHeight=activeTab.offsetHeight;tabWrapper.style.height=activeTabHeight;for await(const el of document.querySelectorAll(".tabs > li"))el.addEventListener("click",eventTabSwitch,!1),el.addEventListener("touchstart",eventTabSwitch,!!supportsPassive&&{passive:!0});const appLoginAction=document.getElementById("login_btn");appLoginAction&&(appLoginAction.addEventListener("click",login_action,!1),appLoginAction.addEventListener("touchstart",login_action,!!supportsPassive&&{passive:!0}));const passwordResetAction=document.getElementById("reset_btn");passwordResetAction&&(passwordResetAction.addEventListener("click",password_reset_action,!1),passwordResetAction.addEventListener("touchstart",password_reset_action,!!supportsPassive&&{passive:!0}))}),!1);