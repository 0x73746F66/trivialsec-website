const save_email=async event=>{if(event.key&&"Enter"!==event.key)return;event.preventDefault();const emailEl=document.getElementById("email");emailEl.classList.remove("error"),emailEl.classList.remove("success");const new_email=emailEl.value,json=await PublicApi.post({target:"/account/update-email",body:{new_email:new_email}});emailEl.classList.add(json.status),toast(json.status,json.message)},regenerate_scratch=async()=>{const scratchEl=document.getElementById("scratch_code"),json=await PublicApi.get({target:"/recovery/regenerate-scratch"});"success"==json.status&&(scratchEl.value=json.scratch_code,scratchEl.disabled=!1,document.getElementById("regenerate").remove()),scratchEl.classList.add(json.status),toast(json.status,json.message)},remove_device=async event=>{const device_id=event.currentTarget.parent("tr").dataset.mfaId;if(!device_id)return void toast("info","This feature is not currently available","Sorry");const json=await PublicApi.post({target:"/mfa/remove-device",body:{device_id:device_id}});event.target.classList.add(json.status),toast(json.status,json.message),"success"===json.status&&document.querySelector(`tr[data-mfa-id="${device_id}"]`).remove()},change_name=async event=>{if(event.key&&"Enter"!==event.key)return;event.preventDefault(),inputHandle&&clearTimeout(inputHandle);const device_name=event.target.textContent,device_id=event.target.parent("tr").dataset.mfaId,json=await PublicApi.post({target:"/mfa/rename-device",body:{device_id:device_id,device_name:device_name}});event.target.classList.add(json.status),toast(json.status,json.message)};var inputHandle;const handle_input=async event=>{inputHandle&&clearTimeout(inputHandle),inputHandle=setTimeout(change_name.bind(null,event),2e3)};document.addEventListener("DOMContentLoaded",(async()=>{"/account/preferences"!=location.pathname&&history.pushState({},document.title,"/account/preferences"),sidebar(),livetime(),setInterval(livetime,1e3);const emailChangeEl=document.getElementById("email");emailChangeEl.addEventListener("change",save_email,!1),emailChangeEl.addEventListener("keypress",save_email,!1);const regenerateEl=document.getElementById("regenerate");regenerateEl&&(regenerateEl.addEventListener("click",regenerate_scratch,!1),regenerateEl.addEventListener("touchstart",regenerate_scratch,!!supportsPassive&&{passive:!0}));for(const el of document.querySelectorAll(".u2fkeyname"))el.addEventListener("input",handle_input,!1),el.addEventListener("keypress",change_name,!1);for(const el of document.querySelectorAll(".remove-device"))el.addEventListener("click",remove_device,!1),el.addEventListener("touchstart",remove_device,!!supportsPassive&&{passive:!0})}),!1);