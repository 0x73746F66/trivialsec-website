const bulkAction=async()=>{const default_role_id=document.getElementById("default_role_id").value,bulk_invite=document.getElementById("bulk_invite").value.split("\n"),invite_message=document.getElementById("invite_message").value,invitationList=document.getElementById("invitation_list");for await(const email of bulk_invite){const invite_email=email.replace(/\s/g,"");if(0===invite_email.length)continue;const json=await Api.post_async("/v1/invitation",{invite_message:invite_message,invite_email:invite_email,invite_role_id:default_role_id}).catch((()=>{toast("error","An unexpected error occurred. Please refresh the page and try again.")}));document.getElementById("invitation-list").style="display: inline-block;";const tmpl=htmlDecode(document.getElementById("tmpl-invitation-list").innerHTML);json.invited_by=app.accountEmail,json.created_at=(new Date).toLocaleString();const row=ejs.render(tmpl,json,{rmWhitespace:!0}),tr=document.createElement("tr");tr.innerHTML=row,invitationList.insertAdjacentElement("beforeend",tr)}},settingsAction=async()=>{const json1=await Api.post_async("/v1/account",[{prop:"alias",value:document.getElementById("alias").value}]).catch((()=>{toast("error","An unexpected error occurred. Please refresh the page and try again.")})),json2=await Api.post_async("/v1/account-config",[{prop:"permit_domains",value:document.getElementById("permit_domains").value}]).catch((()=>{toast("error","An unexpected error occurred. Please refresh the page and try again.")}));"error"==json1.status||"error"==json2.status?"error"!=json1.status?"error"!=json2.status||toast("error",json2.message):toast("error",json1.message):toast("success",`${json1.message} ${json2.message}`)},memberAction=async event=>{const member_id=event.currentTarget.parent("tr").dataset.memberId;location.href=`/account/member/${member_id}`},scannerLists=async()=>{const nameservers=document.getElementById("nameservers").value,ignore_list=document.getElementById("ignore_list").value,json=await Api.post_async("/v1/account-config",[{prop:"nameservers",value:nameservers},{prop:"ignore_list",value:ignore_list}]).catch((()=>{toast("error","An unexpected error occurred. Please refresh the page and try again.")}));toast(json.status,json.message)};document.addEventListener("DOMContentLoaded",(async()=>{"/account/settings"!=location.pathname&&history.pushState({},document.title,"/account/settings"),sidebar(),livetime(),setInterval(livetime,1e3),document.querySelectorAll("select").forEach((el=>{new Choices(el,{searchEnabled:!0})}));const settingsEl=document.getElementById("settings-button");settingsEl.addEventListener("click",settingsAction,!1),settingsEl.addEventListener("touchstart",settingsAction,!!supportsPassive&&{passive:!0});const bulkEl=document.getElementById("bulk_invite_button");bulkEl.addEventListener("click",bulkAction,!1),bulkEl.addEventListener("touchstart",bulkAction,!!supportsPassive&&{passive:!0});for await(const membersEl of document.querySelectorAll(".members-list td"))membersEl.addEventListener("click",memberAction,!1),membersEl.addEventListener("touchstart",memberAction,!!supportsPassive&&{passive:!0});const scannerListsEl=document.getElementById("scanner-lists-button");scannerListsEl.addEventListener("click",scannerLists,!1),scannerListsEl.addEventListener("touchstart",scannerLists,!!supportsPassive&&{passive:!0})}),!1);