class CVSSv3_1{CVSSVersionIdentifier="CVSS:3.1";exploitabilityCoefficient=8.22;scopeCoefficient=1.08;vectorStringRegex_31=/^CVSS:3\.1\/((AV:[NALP]|AC:[LH]|PR:[UNLH]|UI:[NR]|S:[UC]|[CIA]:[NLH]|E:[XUPFH]|RL:[XOTWU]|RC:[XURC]|[CIA]R:[XLMH]|MAV:[XNALP]|MAC:[XLH]|MPR:[XUNLH]|MUI:[XNR]|MS:[XUC]|M[CIA]:[XNLH])\/)*(AV:[NALP]|AC:[LH]|PR:[UNLH]|UI:[NR]|S:[UC]|[CIA]:[NLH]|E:[XUPFH]|RL:[XOTWU]|RC:[XURC]|[CIA]R:[XLMH]|MAV:[XNALP]|MAC:[XLH]|MPR:[XUNLH]|MUI:[XNR]|MS:[XUC]|M[CIA]:[XNLH])$/;Weight={AV:{N:.85,A:.62,L:.55,P:.2},AC:{H:.44,L:.77},PR:{U:{N:.85,L:.62,H:.27},C:{N:.85,L:.68,H:.5}},UI:{N:.85,R:.62},S:{U:6.42,C:7.52},CIA:{N:0,L:.22,H:.56},E:{X:1,U:.91,P:.94,F:.97,H:1},RL:{X:1,O:.95,T:.96,W:.97,U:1},RC:{X:1,U:.92,R:.96,C:1},CIAR:{X:1,L:.5,M:1,H:1.5}};severityRatings=[{name:"None",bottom:0,top:0},{name:"Low",bottom:.1,top:3.9},{name:"Medium",bottom:4,top:6.9},{name:"High",bottom:7,top:8.9},{name:"Critical",bottom:9,top:10}];XML_MetricNames={E:{X:"NOT_DEFINED",U:"UNPROVEN",P:"PROOF_OF_CONCEPT",F:"FUNCTIONAL",H:"HIGH"},RL:{X:"NOT_DEFINED",O:"OFFICIAL_FIX",T:"TEMPORARY_FIX",W:"WORKAROUND",U:"UNAVAILABLE"},RC:{X:"NOT_DEFINED",U:"UNKNOWN",R:"REASONABLE",C:"CONFIRMED"},CIAR:{X:"NOT_DEFINED",L:"LOW",M:"MEDIUM",H:"HIGH"},MAV:{N:"NETWORK",A:"ADJACENT_NETWORK",L:"LOCAL",P:"PHYSICAL",X:"NOT_DEFINED"},MAC:{H:"HIGH",L:"LOW",X:"NOT_DEFINED"},MPR:{N:"NONE",L:"LOW",H:"HIGH",X:"NOT_DEFINED"},MUI:{N:"NONE",R:"REQUIRED",X:"NOT_DEFINED"},MS:{U:"UNCHANGED",C:"CHANGED",X:"NOT_DEFINED"},MCIA:{N:"NONE",L:"LOW",H:"HIGH",X:"NOT_DEFINED"}};constructor(vector){this.vector=vector}static roundUp1(input){let int_input=Math.round(1e5*input);return int_input%1e4==0?int_input/1e5:(Math.floor(int_input/1e4)+1)/10}calculateCVSSFromMetrics(AttackVector,AttackComplexity,PrivilegesRequired,UserInteraction,Scope,Confidentiality,Integrity,Availability,ExploitCodeMaturity,RemediationLevel,ReportConfidence,ConfidentialityRequirement,IntegrityRequirement,AvailabilityRequirement,ModifiedAttackVector,ModifiedAttackComplexity,ModifiedPrivilegesRequired,ModifiedUserInteraction,ModifiedScope,ModifiedConfidentiality,ModifiedIntegrity,ModifiedAvailability){let badMetrics=[];if(void 0!==AttackVector&&""!==AttackVector||badMetrics.push("AV"),void 0!==AttackComplexity&&""!==AttackComplexity||badMetrics.push("AC"),void 0!==PrivilegesRequired&&""!==PrivilegesRequired||badMetrics.push("PR"),void 0!==UserInteraction&&""!==UserInteraction||badMetrics.push("UI"),void 0!==Scope&&""!==Scope||badMetrics.push("S"),void 0!==Confidentiality&&""!==Confidentiality||badMetrics.push("C"),void 0!==Integrity&&""!==Integrity||badMetrics.push("I"),void 0!==Availability&&""!==Availability||badMetrics.push("A"),badMetrics.length>0)return{success:!1,errorType:"MissingBaseMetric",errorMetrics:badMetrics};let AV=AttackVector,AC=AttackComplexity,PR=PrivilegesRequired,UI=UserInteraction,S=Scope,C=Confidentiality,I=Integrity,A=Availability,E=ExploitCodeMaturity||"X",RL=RemediationLevel||"X",RC=ReportConfidence||"X",CR=ConfidentialityRequirement||"X",IR=IntegrityRequirement||"X",AR=AvailabilityRequirement||"X",MAV=ModifiedAttackVector||"X",MAC=ModifiedAttackComplexity||"X",MPR=ModifiedPrivilegesRequired||"X",MUI=ModifiedUserInteraction||"X",MS=ModifiedScope||"X",MC=ModifiedConfidentiality||"X",MI=ModifiedIntegrity||"X",MA=ModifiedAvailability||"X";if(this.Weight.AV.hasOwnProperty(AV)||badMetrics.push("AV"),this.Weight.AC.hasOwnProperty(AC)||badMetrics.push("AC"),this.Weight.PR.U.hasOwnProperty(PR)||badMetrics.push("PR"),this.Weight.UI.hasOwnProperty(UI)||badMetrics.push("UI"),this.Weight.S.hasOwnProperty(S)||badMetrics.push("S"),this.Weight.CIA.hasOwnProperty(C)||badMetrics.push("C"),this.Weight.CIA.hasOwnProperty(I)||badMetrics.push("I"),this.Weight.CIA.hasOwnProperty(A)||badMetrics.push("A"),this.Weight.E.hasOwnProperty(E)||badMetrics.push("E"),this.Weight.RL.hasOwnProperty(RL)||badMetrics.push("RL"),this.Weight.RC.hasOwnProperty(RC)||badMetrics.push("RC"),"X"===CR||this.Weight.CIAR.hasOwnProperty(CR)||badMetrics.push("CR"),"X"===IR||this.Weight.CIAR.hasOwnProperty(IR)||badMetrics.push("IR"),"X"===AR||this.Weight.CIAR.hasOwnProperty(AR)||badMetrics.push("AR"),"X"===MAV||this.Weight.AV.hasOwnProperty(MAV)||badMetrics.push("MAV"),"X"===MAC||this.Weight.AC.hasOwnProperty(MAC)||badMetrics.push("MAC"),"X"===MPR||this.Weight.PR.U.hasOwnProperty(MPR)||badMetrics.push("MPR"),"X"===MUI||this.Weight.UI.hasOwnProperty(MUI)||badMetrics.push("MUI"),"X"===MS||this.Weight.S.hasOwnProperty(MS)||badMetrics.push("MS"),"X"===MC||this.Weight.CIA.hasOwnProperty(MC)||badMetrics.push("MC"),"X"===MI||this.Weight.CIA.hasOwnProperty(MI)||badMetrics.push("MI"),"X"===MA||this.Weight.CIA.hasOwnProperty(MA)||badMetrics.push("MA"),badMetrics.length>0)return{success:!1,errorType:"UnknownMetricValue",errorMetrics:badMetrics};let iss,impact,exploitability,baseScore,metricWeightAV=this.Weight.AV[AV],metricWeightAC=this.Weight.AC[AC],metricWeightPR=this.Weight.PR[S][PR],metricWeightUI=this.Weight.UI[UI],metricWeightS=this.Weight.S[S],metricWeightC=this.Weight.CIA[C],metricWeightI=this.Weight.CIA[I],metricWeightA=this.Weight.CIA[A],metricWeightE=this.Weight.E[E],metricWeightRL=this.Weight.RL[RL],metricWeightRC=this.Weight.RC[RC],metricWeightCR=this.Weight.CIAR[CR],metricWeightIR=this.Weight.CIAR[IR],metricWeightAR=this.Weight.CIAR[AR],metricWeightMAV=this.Weight.AV["X"!==MAV?MAV:AV],metricWeightMAC=this.Weight.AC["X"!==MAC?MAC:AC],metricWeightMPR=this.Weight.PR["X"!==MS?MS:S]["X"!==MPR?MPR:PR],metricWeightMUI=this.Weight.UI["X"!==MUI?MUI:UI],metricWeightMS=this.Weight.S["X"!==MS?MS:S],metricWeightMC=this.Weight.CIA["X"!==MC?MC:C],metricWeightMI=this.Weight.CIA["X"!==MI?MI:I],metricWeightMA=this.Weight.CIA["X"!==MA?MA:A];iss=1-(1-metricWeightC)*(1-metricWeightI)*(1-metricWeightA),impact="U"===S?metricWeightS*iss:metricWeightS*(iss-.029)-3.25*Math.pow(iss-.02,15),exploitability=this.exploitabilityCoefficient*metricWeightAV*metricWeightAC*metricWeightPR*metricWeightUI,baseScore=impact<=0?0:"U"===S?CVSSv3_1.roundUp1(Math.min(exploitability+impact,10)):CVSSv3_1.roundUp1(Math.min(this.scopeCoefficient*(exploitability+impact),10));let miss,modifiedImpact,envScore,modifiedExploitability,temporalScore=CVSSv3_1.roundUp1(baseScore*metricWeightE*metricWeightRL*metricWeightRC);miss=Math.min(1-(1-metricWeightMC*metricWeightCR)*(1-metricWeightMI*metricWeightIR)*(1-metricWeightMA*metricWeightAR),.915),modifiedImpact="U"===MS||"X"===MS&&"U"===S?metricWeightMS*miss:metricWeightMS*(miss-.029)-3.25*Math.pow(.9731*miss-.02,13),modifiedExploitability=this.exploitabilityCoefficient*metricWeightMAV*metricWeightMAC*metricWeightMPR*metricWeightMUI,envScore=modifiedImpact<=0?0:"U"===MS||"X"===MS&&"U"===S?CVSSv3_1.roundUp1(CVSSv3_1.roundUp1(Math.min(modifiedImpact+modifiedExploitability,10))*metricWeightE*metricWeightRL*metricWeightRC):CVSSv3_1.roundUp1(CVSSv3_1.roundUp1(Math.min(this.scopeCoefficient*(modifiedImpact+modifiedExploitability),10))*metricWeightE*metricWeightRL*metricWeightRC);let vectorString=this.CVSSVersionIdentifier+"/AV:"+AV+"/AC:"+AC+"/PR:"+PR+"/UI:"+UI+"/S:"+S+"/C:"+C+"/I:"+I+"/A:"+A;"X"!==E&&(vectorString=vectorString+"/E:"+E),"X"!==RL&&(vectorString=vectorString+"/RL:"+RL),"X"!==RC&&(vectorString=vectorString+"/RC:"+RC),"X"!==CR&&(vectorString=vectorString+"/CR:"+CR),"X"!==IR&&(vectorString=vectorString+"/IR:"+IR),"X"!==AR&&(vectorString=vectorString+"/AR:"+AR),"X"!==MAV&&(vectorString=vectorString+"/MAV:"+MAV),"X"!==MAC&&(vectorString=vectorString+"/MAC:"+MAC),"X"!==MPR&&(vectorString=vectorString+"/MPR:"+MPR),"X"!==MUI&&(vectorString=vectorString+"/MUI:"+MUI),"X"!==MS&&(vectorString=vectorString+"/MS:"+MS),"X"!==MC&&(vectorString=vectorString+"/MC:"+MC),"X"!==MI&&(vectorString=vectorString+"/MI:"+MI),"X"!==MA&&(vectorString=vectorString+"/MA:"+MA);const result={success:!0,baseMetricScore:baseScore.toFixed(1),baseSeverity:this.severityRating(baseScore.toFixed(1)),baseISS:iss,baseImpact:impact,baseExploitability:exploitability,temporalMetricScore:temporalScore.toFixed(1),temporalSeverity:this.severityRating(temporalScore.toFixed(1)),environmentalMetricScore:envScore.toFixed(1),environmentalSeverity:this.severityRating(envScore.toFixed(1)),environmentalMISS:miss,environmentalModifiedImpact:modifiedImpact,environmentalModifiedExploitability:modifiedExploitability,vectorString:vectorString};return this.baseMetricScore=result.baseMetricScore,this.baseSeverity=result.baseSeverity,this.baseISS=result.baseISS,this.baseImpact=result.baseImpact,this.baseExploitability=result.baseExploitability,this.temporalMetricScore=result.temporalMetricScore,this.temporalSeverity=result.temporalSeverity,this.environmentalMetricScore=result.environmentalMetricScore,this.environmentalSeverity=result.environmentalSeverity,this.environmentalMISS=result.environmentalMISS,this.environmentalModifiedImpact=result.environmentalModifiedImpact,this.environmentalModifiedExploitability=result.environmentalModifiedExploitability,result}calculateCVSSFromVector(vectorString){vectorString??=this.vector;let metricValues={AV:void 0,AC:void 0,PR:void 0,UI:void 0,S:void 0,C:void 0,I:void 0,A:void 0,E:void 0,RL:void 0,RC:void 0,CR:void 0,IR:void 0,AR:void 0,MAV:void 0,MAC:void 0,MPR:void 0,MUI:void 0,MS:void 0,MC:void 0,MI:void 0,MA:void 0},badMetrics=[];if(!this.vectorStringRegex_31.test(vectorString))return{success:!1,errorType:"MalformedVectorString"};let metricNameValue=vectorString.substring(this.CVSSVersionIdentifier.length).split("/");for(let i in metricNameValue)if(metricNameValue.hasOwnProperty(i)){let singleMetric=metricNameValue[i].split(":");void 0===metricValues[singleMetric[0]]?metricValues[singleMetric[0]]=singleMetric[1]:badMetrics.push(singleMetric[0])}return badMetrics.length>0?{success:!1,errorType:"MultipleDefinitionsOfMetric",errorMetrics:badMetrics}:this.calculateCVSSFromMetrics(metricValues.AV,metricValues.AC,metricValues.PR,metricValues.UI,metricValues.S,metricValues.C,metricValues.I,metricValues.A,metricValues.E,metricValues.RL,metricValues.RC,metricValues.CR,metricValues.IR,metricValues.AR,metricValues.MAV,metricValues.MAC,metricValues.MPR,metricValues.MUI,metricValues.MS,metricValues.MC,metricValues.MI,metricValues.MA)}severityRating(score){let severityRatingLength=this.severityRatings.length,validatedScore=Number(score);if(isNaN(validatedScore))return validatedScore;for(let i=0;i<severityRatingLength;i++)if(score>=this.severityRatings[i].bottom&&score<=this.severityRatings[i].top)return this.severityRatings[i].name}generateXMLFromMetrics(AttackVector,AttackComplexity,PrivilegesRequired,UserInteraction,Scope,Confidentiality,Integrity,Availability,ExploitCodeMaturity,RemediationLevel,ReportConfidence,ConfidentialityRequirement,IntegrityRequirement,AvailabilityRequirement,ModifiedAttackVector,ModifiedAttackComplexity,ModifiedPrivilegesRequired,ModifiedUserInteraction,ModifiedScope,ModifiedConfidentiality,ModifiedIntegrity,ModifiedAvailability){let result=this.calculateCVSSFromMetrics(AttackVector,AttackComplexity,PrivilegesRequired,UserInteraction,Scope,Confidentiality,Integrity,Availability,ExploitCodeMaturity,RemediationLevel,ReportConfidence,ConfidentialityRequirement,IntegrityRequirement,AvailabilityRequirement,ModifiedAttackVector,ModifiedAttackComplexity,ModifiedPrivilegesRequired,ModifiedUserInteraction,ModifiedScope,ModifiedConfidentiality,ModifiedIntegrity,ModifiedAvailability);if(!0!==result.success)return result;let xmlOutput='<?xml version="1.0" encoding="UTF-8"?>\n<cvssv3.1 xmlns="https://www.first.org/cvss/cvss-v3.1.xsd"\n  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n  xsi:schemaLocation="https://www.first.org/cvss/cvss-v3.1.xsd https://www.first.org/cvss/cvss-v3.1.xsd"\n  >\n\n  <base_metrics>\n    <attack-vector>__AttackVector__</attack-vector>\n    <attack-complexity>__AttackComplexity__</attack-complexity>\n    <privileges-required>__PrivilegesRequired__</privileges-required>\n    <user-interaction>__UserInteraction__</user-interaction>\n    <scope>__Scope__</scope>\n    <confidentiality-impact>__Confidentiality__</confidentiality-impact>\n    <integrity-impact>__Integrity__</integrity-impact>\n    <availability-impact>__Availability__</availability-impact>\n    <base-score>__BaseScore__</base-score>\n    <base-severity>__BaseSeverityRating__</base-severity>\n  </base_metrics>\n\n  <temporal_metrics>\n    <exploit-code-maturity>__ExploitCodeMaturity__</exploit-code-maturity>\n    <remediation-level>__RemediationLevel__</remediation-level>\n    <report-confidence>__ReportConfidence__</report-confidence>\n    <temporal-score>__TemporalScore__</temporal-score>\n    <temporal-severity>__TemporalSeverityRating__</temporal-severity>\n  </temporal_metrics>\n\n  <environmental_metrics>\n    <confidentiality-requirement>__ConfidentialityRequirement__</confidentiality-requirement>\n    <integrity-requirement>__IntegrityRequirement__</integrity-requirement>\n    <availability-requirement>__AvailabilityRequirement__</availability-requirement>\n    <modified-attack-vector>__ModifiedAttackVector__</modified-attack-vector>\n    <modified-attack-complexity>__ModifiedAttackComplexity__</modified-attack-complexity>\n    <modified-privileges-required>__ModifiedPrivilegesRequired__</modified-privileges-required>\n    <modified-user-interaction>__ModifiedUserInteraction__</modified-user-interaction>\n    <modified-scope>__ModifiedScope__</modified-scope>\n    <modified-confidentiality-impact>__ModifiedConfidentiality__</modified-confidentiality-impact>\n    <modified-integrity-impact>__ModifiedIntegrity__</modified-integrity-impact>\n    <modified-availability-impact>__ModifiedAvailability__</modified-availability-impact>\n    <environmental-score>__EnvironmentalScore__</environmental-score>\n    <environmental-severity>__EnvironmentalSeverityRating__</environmental-severity>\n  </environmental_metrics>\n\n</cvssv3.1>\n';return xmlOutput=xmlOutput.replace("__AttackVector__",this.XML_MetricNames.MAV[AttackVector]),xmlOutput=xmlOutput.replace("__AttackComplexity__",this.XML_MetricNames.MAC[AttackComplexity]),xmlOutput=xmlOutput.replace("__PrivilegesRequired__",this.XML_MetricNames.MPR[PrivilegesRequired]),xmlOutput=xmlOutput.replace("__UserInteraction__",this.XML_MetricNames.MUI[UserInteraction]),xmlOutput=xmlOutput.replace("__Scope__",this.XML_MetricNames.MS[Scope]),xmlOutput=xmlOutput.replace("__Confidentiality__",this.XML_MetricNames.MCIA[Confidentiality]),xmlOutput=xmlOutput.replace("__Integrity__",this.XML_MetricNames.MCIA[Integrity]),xmlOutput=xmlOutput.replace("__Availability__",this.XML_MetricNames.MCIA[Availability]),xmlOutput=xmlOutput.replace("__BaseScore__",result.baseMetricScore),xmlOutput=xmlOutput.replace("__BaseSeverityRating__",result.baseSeverity),xmlOutput=xmlOutput.replace("__ExploitCodeMaturity__",this.XML_MetricNames.E[ExploitCodeMaturity||"X"]),xmlOutput=xmlOutput.replace("__RemediationLevel__",this.XML_MetricNames.RL[RemediationLevel||"X"]),xmlOutput=xmlOutput.replace("__ReportConfidence__",this.XML_MetricNames.RC[ReportConfidence||"X"]),xmlOutput=xmlOutput.replace("__TemporalScore__",result.temporalMetricScore),xmlOutput=xmlOutput.replace("__TemporalSeverityRating__",result.temporalSeverity),xmlOutput=xmlOutput.replace("__ConfidentialityRequirement__",this.XML_MetricNames.CIAR[ConfidentialityRequirement||"X"]),xmlOutput=xmlOutput.replace("__IntegrityRequirement__",this.XML_MetricNames.CIAR[IntegrityRequirement||"X"]),xmlOutput=xmlOutput.replace("__AvailabilityRequirement__",this.XML_MetricNames.CIAR[AvailabilityRequirement||"X"]),xmlOutput=xmlOutput.replace("__ModifiedAttackVector__",this.XML_MetricNames.MAV[ModifiedAttackVector||"X"]),xmlOutput=xmlOutput.replace("__ModifiedAttackComplexity__",this.XML_MetricNames.MAC[ModifiedAttackComplexity||"X"]),xmlOutput=xmlOutput.replace("__ModifiedPrivilegesRequired__",this.XML_MetricNames.MPR[ModifiedPrivilegesRequired||"X"]),xmlOutput=xmlOutput.replace("__ModifiedUserInteraction__",this.XML_MetricNames.MUI[ModifiedUserInteraction||"X"]),xmlOutput=xmlOutput.replace("__ModifiedScope__",this.XML_MetricNames.MS[ModifiedScope||"X"]),xmlOutput=xmlOutput.replace("__ModifiedConfidentiality__",this.XML_MetricNames.MCIA[ModifiedConfidentiality||"X"]),xmlOutput=xmlOutput.replace("__ModifiedIntegrity__",this.XML_MetricNames.MCIA[ModifiedIntegrity||"X"]),xmlOutput=xmlOutput.replace("__ModifiedAvailability__",this.XML_MetricNames.MCIA[ModifiedAvailability||"X"]),xmlOutput=xmlOutput.replace("__EnvironmentalScore__",result.environmentalMetricScore),xmlOutput=xmlOutput.replace("__EnvironmentalSeverityRating__",result.environmentalSeverity),{success:!0,xmlString:xmlOutput}}generateXMLFromVector(vectorString){let metricValues={AV:void 0,AC:void 0,PR:void 0,UI:void 0,S:void 0,C:void 0,I:void 0,A:void 0,E:void 0,RL:void 0,RC:void 0,CR:void 0,IR:void 0,AR:void 0,MAV:void 0,MAC:void 0,MPR:void 0,MUI:void 0,MS:void 0,MC:void 0,MI:void 0,MA:void 0},badMetrics=[];if(!this.vectorStringRegex_31.test(vectorString))return{success:!1,errorType:"MalformedVectorString"};let metricNameValue=vectorString.substring(this.CVSSVersionIdentifier.length).split("/");for(let i in metricNameValue)if(metricNameValue.hasOwnProperty(i)){let singleMetric=metricNameValue[i].split(":");void 0===metricValues[singleMetric[0]]?metricValues[singleMetric[0]]=singleMetric[1]:badMetrics.push(singleMetric[0])}return badMetrics.length>0?{success:!1,errorType:"MultipleDefinitionsOfMetric",errorMetrics:badMetrics}:this.generateXMLFromMetrics(metricValues.AV,metricValues.AC,metricValues.PR,metricValues.UI,metricValues.S,metricValues.C,metricValues.I,metricValues.A,metricValues.E,metricValues.RL,metricValues.RC,metricValues.CR,metricValues.IR,metricValues.AR,metricValues.MAV,metricValues.MAC,metricValues.MPR,metricValues.MUI,metricValues.MS,metricValues.MC,metricValues.MI,metricValues.MA)}}class CVSSv3_0{CVSSVersionIdentifier="CVSS:3.0";exploitabilityCoefficient=8.22;scopeCoefficient=1.08;vectorStringRegex_30=/^CVSS:3\.0\/((AV:[NALP]|AC:[LH]|PR:[UNLH]|UI:[NR]|S:[UC]|[CIA]:[NLH]|E:[XUPFH]|RL:[XOTWU]|RC:[XURC]|[CIA]R:[XLMH]|MAV:[XNALP]|MAC:[XLH]|MPR:[XUNLH]|MUI:[XNR]|MS:[XUC]|M[CIA]:[XNLH])\/)*(AV:[NALP]|AC:[LH]|PR:[UNLH]|UI:[NR]|S:[UC]|[CIA]:[NLH]|E:[XUPFH]|RL:[XOTWU]|RC:[XURC]|[CIA]R:[XLMH]|MAV:[XNALP]|MAC:[XLH]|MPR:[XUNLH]|MUI:[XNR]|MS:[XUC]|M[CIA]:[XNLH])$/;Weight={AV:{N:.85,A:.62,L:.55,P:.2},AC:{H:.44,L:.77},PR:{U:{N:.85,L:.62,H:.27},C:{N:.85,L:.68,H:.5}},UI:{N:.85,R:.62},S:{U:6.42,C:7.52},CIA:{N:0,L:.22,H:.56},E:{X:1,U:.91,P:.94,F:.97,H:1},RL:{X:1,O:.95,T:.96,W:.97,U:1},RC:{X:1,U:.92,R:.96,C:1},CIAR:{X:1,L:.5,M:1,H:1.5}};severityRatings=[{name:"None",bottom:0,top:0},{name:"Low",bottom:.1,top:3.9},{name:"Medium",bottom:4,top:6.9},{name:"High",bottom:7,top:8.9},{name:"Critical",bottom:9,top:10}];XML_MetricNames={E:{X:"NOT_DEFINED",U:"UNPROVEN",P:"PROOF_OF_CONCEPT",F:"FUNCTIONAL",H:"HIGH"},RL:{X:"NOT_DEFINED",O:"OFFICIAL_FIX",T:"TEMPORARY_FIX",W:"WORKAROUND",U:"UNAVAILABLE"},RC:{X:"NOT_DEFINED",U:"UNKNOWN",R:"REASONABLE",C:"CONFIRMED"},CIAR:{X:"NOT_DEFINED",L:"LOW",M:"MEDIUM",H:"HIGH"},MAV:{N:"NETWORK",A:"ADJACENT_NETWORK",L:"LOCAL",P:"PHYSICAL",X:"NOT_DEFINED"},MAC:{H:"HIGH",L:"LOW",X:"NOT_DEFINED"},MPR:{N:"NONE",L:"LOW",H:"HIGH",X:"NOT_DEFINED"},MUI:{N:"NONE",R:"REQUIRED",X:"NOT_DEFINED"},MS:{U:"UNCHANGED",C:"CHANGED",X:"NOT_DEFINED"},MCIA:{N:"NONE",L:"LOW",H:"HIGH",X:"NOT_DEFINED"}};static roundUp1(d){return Math.ceil(10*d)/10}constructor(vector){this.vector=vector}calculateCVSSFromMetrics(AttackVector,AttackComplexity,PrivilegesRequired,UserInteraction,Scope,Confidentiality,Integrity,Availability,ExploitCodeMaturity,RemediationLevel,ReportConfidence,ConfidentialityRequirement,IntegrityRequirement,AvailabilityRequirement,ModifiedAttackVector,ModifiedAttackComplexity,ModifiedPrivilegesRequired,ModifiedUserInteraction,ModifiedScope,ModifiedConfidentiality,ModifiedIntegrity,ModifiedAvailability){let badMetrics=[];if(void 0!==AttackVector&&""!==AttackVector||badMetrics.push("AV"),void 0!==AttackComplexity&&""!==AttackComplexity||badMetrics.push("AC"),void 0!==PrivilegesRequired&&""!==PrivilegesRequired||badMetrics.push("PR"),void 0!==UserInteraction&&""!==UserInteraction||badMetrics.push("UI"),void 0!==Scope&&""!==Scope||badMetrics.push("S"),void 0!==Confidentiality&&""!==Confidentiality||badMetrics.push("C"),void 0!==Integrity&&""!==Integrity||badMetrics.push("I"),void 0!==Availability&&""!==Availability||badMetrics.push("A"),badMetrics.length>0)return{success:!1,errorType:"MissingBaseMetric",errorMetrics:badMetrics};let AV=AttackVector,AC=AttackComplexity,PR=PrivilegesRequired,UI=UserInteraction,S=Scope,C=Confidentiality,I=Integrity,A=Availability,E=ExploitCodeMaturity||"X",RL=RemediationLevel||"X",RC=ReportConfidence||"X",CR=ConfidentialityRequirement||"X",IR=IntegrityRequirement||"X",AR=AvailabilityRequirement||"X",MAV=ModifiedAttackVector||"X",MAC=ModifiedAttackComplexity||"X",MPR=ModifiedPrivilegesRequired||"X",MUI=ModifiedUserInteraction||"X",MS=ModifiedScope||"X",MC=ModifiedConfidentiality||"X",MI=ModifiedIntegrity||"X",MA=ModifiedAvailability||"X";if(this.Weight.AV.hasOwnProperty(AV)||badMetrics.push("AV"),this.Weight.AC.hasOwnProperty(AC)||badMetrics.push("AC"),this.Weight.PR.U.hasOwnProperty(PR)||badMetrics.push("PR"),this.Weight.UI.hasOwnProperty(UI)||badMetrics.push("UI"),this.Weight.S.hasOwnProperty(S)||badMetrics.push("S"),this.Weight.CIA.hasOwnProperty(C)||badMetrics.push("C"),this.Weight.CIA.hasOwnProperty(I)||badMetrics.push("I"),this.Weight.CIA.hasOwnProperty(A)||badMetrics.push("A"),this.Weight.E.hasOwnProperty(E)||badMetrics.push("E"),this.Weight.RL.hasOwnProperty(RL)||badMetrics.push("RL"),this.Weight.RC.hasOwnProperty(RC)||badMetrics.push("RC"),"X"===CR||this.Weight.CIAR.hasOwnProperty(CR)||badMetrics.push("CR"),"X"===IR||this.Weight.CIAR.hasOwnProperty(IR)||badMetrics.push("IR"),"X"===AR||this.Weight.CIAR.hasOwnProperty(AR)||badMetrics.push("AR"),"X"===MAV||this.Weight.AV.hasOwnProperty(MAV)||badMetrics.push("MAV"),"X"===MAC||this.Weight.AC.hasOwnProperty(MAC)||badMetrics.push("MAC"),"X"===MPR||this.Weight.PR.U.hasOwnProperty(MPR)||badMetrics.push("MPR"),"X"===MUI||this.Weight.UI.hasOwnProperty(MUI)||badMetrics.push("MUI"),"X"===MS||this.Weight.S.hasOwnProperty(MS)||badMetrics.push("MS"),"X"===MC||this.Weight.CIA.hasOwnProperty(MC)||badMetrics.push("MC"),"X"===MI||this.Weight.CIA.hasOwnProperty(MI)||badMetrics.push("MI"),"X"===MA||this.Weight.CIA.hasOwnProperty(MA)||badMetrics.push("MA"),badMetrics.length>0)return{success:!1,errorType:"UnknownMetricValue",errorMetrics:badMetrics};let baseScore,impactSubScore,metricWeightAV=this.Weight.AV[AV],metricWeightAC=this.Weight.AC[AC],metricWeightPR=this.Weight.PR[S][PR],metricWeightUI=this.Weight.UI[UI],metricWeightS=this.Weight.S[S],metricWeightC=this.Weight.CIA[C],metricWeightI=this.Weight.CIA[I],metricWeightA=this.Weight.CIA[A],metricWeightE=this.Weight.E[E],metricWeightRL=this.Weight.RL[RL],metricWeightRC=this.Weight.RC[RC],metricWeightCR=this.Weight.CIAR[CR],metricWeightIR=this.Weight.CIAR[IR],metricWeightAR=this.Weight.CIAR[AR],metricWeightMAV=this.Weight.AV["X"!==MAV?MAV:AV],metricWeightMAC=this.Weight.AC["X"!==MAC?MAC:AC],metricWeightMPR=this.Weight.PR["X"!==MS?MS:S]["X"!==MPR?MPR:PR],metricWeightMUI=this.Weight.UI["X"!==MUI?MUI:UI],metricWeightMS=this.Weight.S["X"!==MS?MS:S],metricWeightMC=this.Weight.CIA["X"!==MC?MC:C],metricWeightMI=this.Weight.CIA["X"!==MI?MI:I],metricWeightMA=this.Weight.CIA["X"!==MA?MA:A],exploitabalitySubScore=this.exploitabilityCoefficient*metricWeightAV*metricWeightAC*metricWeightPR*metricWeightUI,impactSubScoreMultiplier=1-(1-metricWeightC)*(1-metricWeightI)*(1-metricWeightA);impactSubScore="U"===S?metricWeightS*impactSubScoreMultiplier:metricWeightS*(impactSubScoreMultiplier-.029)-3.25*Math.pow(impactSubScoreMultiplier-.02,15),baseScore=impactSubScore<=0?0:"U"===S?CVSSv3_0.roundUp1(Math.min(exploitabalitySubScore+impactSubScore,10)):CVSSv3_0.roundUp1(Math.min((exploitabalitySubScore+impactSubScore)*this.scopeCoefficient,10));let envScore,envModifiedImpactSubScore,temporalScore=CVSSv3_0.roundUp1(baseScore*metricWeightE*metricWeightRL*metricWeightRC),envModifiedExploitabalitySubScore=this.exploitabilityCoefficient*metricWeightMAV*metricWeightMAC*metricWeightMPR*metricWeightMUI,envImpactSubScoreMultiplier=Math.min(1-(1-metricWeightMC*metricWeightCR)*(1-metricWeightMI*metricWeightIR)*(1-metricWeightMA*metricWeightAR),.915);"U"===MS||"X"===MS&&"U"===S?(envModifiedImpactSubScore=metricWeightMS*envImpactSubScoreMultiplier,envScore=CVSSv3_0.roundUp1(CVSSv3_0.roundUp1(Math.min(envModifiedImpactSubScore+envModifiedExploitabalitySubScore,10))*metricWeightE*metricWeightRL*metricWeightRC)):(envModifiedImpactSubScore=metricWeightMS*(envImpactSubScoreMultiplier-.029)-3.25*Math.pow(envImpactSubScoreMultiplier-.02,15),envScore=CVSSv3_0.roundUp1(CVSSv3_0.roundUp1(Math.min(this.scopeCoefficient*(envModifiedImpactSubScore+envModifiedExploitabalitySubScore),10))*metricWeightE*metricWeightRL*metricWeightRC)),envModifiedImpactSubScore<=0&&(envScore=0);let vectorString=this.CVSSVersionIdentifier+"/AV:"+AV+"/AC:"+AC+"/PR:"+PR+"/UI:"+UI+"/S:"+S+"/C:"+C+"/I:"+I+"/A:"+A;"X"!==E&&(vectorString=vectorString+"/E:"+E),"X"!==RL&&(vectorString=vectorString+"/RL:"+RL),"X"!==RC&&(vectorString=vectorString+"/RC:"+RC),"X"!==CR&&(vectorString=vectorString+"/CR:"+CR),"X"!==IR&&(vectorString=vectorString+"/IR:"+IR),"X"!==AR&&(vectorString=vectorString+"/AR:"+AR),"X"!==MAV&&(vectorString=vectorString+"/MAV:"+MAV),"X"!==MAC&&(vectorString=vectorString+"/MAC:"+MAC),"X"!==MPR&&(vectorString=vectorString+"/MPR:"+MPR),"X"!==MUI&&(vectorString=vectorString+"/MUI:"+MUI),"X"!==MS&&(vectorString=vectorString+"/MS:"+MS),"X"!==MC&&(vectorString=vectorString+"/MC:"+MC),"X"!==MI&&(vectorString=vectorString+"/MI:"+MI),"X"!==MA&&(vectorString=vectorString+"/MA:"+MA);const result={success:!0,baseMetricScore:baseScore.toFixed(1),baseSeverity:this.severityRating(baseScore.toFixed(1)),temporalMetricScore:temporalScore.toFixed(1),temporalSeverity:this.severityRating(temporalScore.toFixed(1)),environmentalMetricScore:envScore.toFixed(1),environmentalSeverity:this.severityRating(envScore.toFixed(1)),vectorString:vectorString};return this.baseMetricScore=result.baseMetricScore,this.baseSeverity=result.baseSeverity,this.environmentalMetricScore=result.environmentalMetricScore,this.environmentalSeverity=result.environmentalSeverity,this.temporalMetricScore=result.temporalMetricScore,this.temporalSeverity=result.temporalSeverity,result}calculateCVSSFromVector(vectorString){vectorString??=this.vector;let metricValues={AV:void 0,AC:void 0,PR:void 0,UI:void 0,S:void 0,C:void 0,I:void 0,A:void 0,E:void 0,RL:void 0,RC:void 0,CR:void 0,IR:void 0,AR:void 0,MAV:void 0,MAC:void 0,MPR:void 0,MUI:void 0,MS:void 0,MC:void 0,MI:void 0,MA:void 0},badMetrics=[];if(!this.vectorStringRegex_30.test(vectorString))return{success:!1,errorType:"MalformedVectorString"};let metricNameValue=vectorString.substring(this.CVSSVersionIdentifier.length).split("/");for(let i in metricNameValue)if(metricNameValue.hasOwnProperty(i)){let singleMetric=metricNameValue[i].split(":");void 0===metricValues[singleMetric[0]]?metricValues[singleMetric[0]]=singleMetric[1]:badMetrics.push(singleMetric[0])}return badMetrics.length>0?{success:!1,errorType:"MultipleDefinitionsOfMetric",errorMetrics:badMetrics}:this.calculateCVSSFromMetrics(metricValues.AV,metricValues.AC,metricValues.PR,metricValues.UI,metricValues.S,metricValues.C,metricValues.I,metricValues.A,metricValues.E,metricValues.RL,metricValues.RC,metricValues.CR,metricValues.IR,metricValues.AR,metricValues.MAV,metricValues.MAC,metricValues.MPR,metricValues.MUI,metricValues.MS,metricValues.MC,metricValues.MI,metricValues.MA)}severityRating(score){let severityRatingLength=this.severityRatings.length,validatedScore=Number(score);if(isNaN(validatedScore))return validatedScore;for(let i=0;i<severityRatingLength;i++)if(score>=this.severityRatings[i].bottom&&score<=this.severityRatings[i].top)return this.severityRatings[i].name}generateXMLFromMetrics(AttackVector,AttackComplexity,PrivilegesRequired,UserInteraction,Scope,Confidentiality,Integrity,Availability,ExploitCodeMaturity,RemediationLevel,ReportConfidence,ConfidentialityRequirement,IntegrityRequirement,AvailabilityRequirement,ModifiedAttackVector,ModifiedAttackComplexity,ModifiedPrivilegesRequired,ModifiedUserInteraction,ModifiedScope,ModifiedConfidentiality,ModifiedIntegrity,ModifiedAvailability){let result=this.calculateCVSSFromMetrics(AttackVector,AttackComplexity,PrivilegesRequired,UserInteraction,Scope,Confidentiality,Integrity,Availability,ExploitCodeMaturity,RemediationLevel,ReportConfidence,ConfidentialityRequirement,IntegrityRequirement,AvailabilityRequirement,ModifiedAttackVector,ModifiedAttackComplexity,ModifiedPrivilegesRequired,ModifiedUserInteraction,ModifiedScope,ModifiedConfidentiality,ModifiedIntegrity,ModifiedAvailability);if(!0!==result.success)return result;let xmlOutput='<?xml version="1.0" encoding="UTF-8"?>\n<cvssv3.0 xmlns="https://www.first.org/cvss/cvss-v3.0.xsd"\n  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n  xsi:schemaLocation="https://www.first.org/cvss/cvss-v3.0.xsd https://www.first.org/cvss/cvss-v3.0.xsd"\n  >\n\n  <base_metrics>\n    <attack-vector>__AttackVector__</attack-vector>\n    <attack-complexity>__AttackComplexity__</attack-complexity>\n    <privileges-required>__PrivilegesRequired__</privileges-required>\n    <user-interaction>__UserInteraction__</user-interaction>\n    <scope>__Scope__</scope>\n    <confidentiality-impact>__Confidentiality__</confidentiality-impact>\n    <integrity-impact>__Integrity__</integrity-impact>\n    <availability-impact>__Availability__</availability-impact>\n    <base-score>__BaseScore__</base-score>\n    <base-severity>__BaseSeverityRating__</base-severity>\n  </base_metrics>\n\n  <temporal_metrics>\n    <exploit-code-maturity>__ExploitCodeMaturity__</exploit-code-maturity>\n    <remediation-level>__RemediationLevel__</remediation-level>\n    <report-confidence>__ReportConfidence__</report-confidence>\n    <temporal-score>__TemporalScore__</temporal-score>\n    <temporal-severity>__TemporalSeverityRating__</temporal-severity>\n  </temporal_metrics>\n\n  <environmental_metrics>\n    <confidentiality-requirement>__ConfidentialityRequirement__</confidentiality-requirement>\n    <integrity-requirement>__IntegrityRequirement__</integrity-requirement>\n    <availability-requirement>__AvailabilityRequirement__</availability-requirement>\n    <modified-attack-vector>__ModifiedAttackVector__</modified-attack-vector>\n    <modified-attack-complexity>__ModifiedAttackComplexity__</modified-attack-complexity>\n    <modified-privileges-required>__ModifiedPrivilegesRequired__</modified-privileges-required>\n    <modified-user-interaction>__ModifiedUserInteraction__</modified-user-interaction>\n    <modified-scope>__ModifiedScope__</modified-scope>\n    <modified-confidentiality-impact>__ModifiedConfidentiality__</modified-confidentiality-impact>\n    <modified-integrity-impact>__ModifiedIntegrity__</modified-integrity-impact>\n    <modified-availability-impact>__ModifiedAvailability__</modified-availability-impact>\n    <environmental-score>__EnvironmentalScore__</environmental-score>\n    <environmental-severity>__EnvironmentalSeverityRating__</environmental-severity>\n  </environmental_metrics>\n\n</cvssv3.0>\n';return xmlOutput=xmlOutput.replace("__AttackVector__",this.XML_MetricNames.MAV[AttackVector]),xmlOutput=xmlOutput.replace("__AttackComplexity__",this.XML_MetricNames.MAC[AttackComplexity]),xmlOutput=xmlOutput.replace("__PrivilegesRequired__",this.XML_MetricNames.MPR[PrivilegesRequired]),xmlOutput=xmlOutput.replace("__UserInteraction__",this.XML_MetricNames.MUI[UserInteraction]),xmlOutput=xmlOutput.replace("__Scope__",this.XML_MetricNames.MS[Scope]),xmlOutput=xmlOutput.replace("__Confidentiality__",this.XML_MetricNames.MCIA[Confidentiality]),xmlOutput=xmlOutput.replace("__Integrity__",this.XML_MetricNames.MCIA[Integrity]),xmlOutput=xmlOutput.replace("__Availability__",this.XML_MetricNames.MCIA[Availability]),xmlOutput=xmlOutput.replace("__BaseScore__",result.baseMetricScore),xmlOutput=xmlOutput.replace("__BaseSeverityRating__",result.baseSeverity),xmlOutput=xmlOutput.replace("__ExploitCodeMaturity__",this.XML_MetricNames.E[ExploitCodeMaturity||"X"]),xmlOutput=xmlOutput.replace("__RemediationLevel__",this.XML_MetricNames.RL[RemediationLevel||"X"]),xmlOutput=xmlOutput.replace("__ReportConfidence__",this.XML_MetricNames.RC[ReportConfidence||"X"]),xmlOutput=xmlOutput.replace("__TemporalScore__",result.temporalMetricScore),xmlOutput=xmlOutput.replace("__TemporalSeverityRating__",result.temporalSeverity),xmlOutput=xmlOutput.replace("__ConfidentialityRequirement__",this.XML_MetricNames.CIAR[ConfidentialityRequirement||"X"]),xmlOutput=xmlOutput.replace("__IntegrityRequirement__",this.XML_MetricNames.CIAR[IntegrityRequirement||"X"]),xmlOutput=xmlOutput.replace("__AvailabilityRequirement__",this.XML_MetricNames.CIAR[AvailabilityRequirement||"X"]),xmlOutput=xmlOutput.replace("__ModifiedAttackVector__",this.XML_MetricNames.MAV[ModifiedAttackVector||"X"]),xmlOutput=xmlOutput.replace("__ModifiedAttackComplexity__",this.XML_MetricNames.MAC[ModifiedAttackComplexity||"X"]),xmlOutput=xmlOutput.replace("__ModifiedPrivilegesRequired__",this.XML_MetricNames.MPR[ModifiedPrivilegesRequired||"X"]),xmlOutput=xmlOutput.replace("__ModifiedUserInteraction__",this.XML_MetricNames.MUI[ModifiedUserInteraction||"X"]),xmlOutput=xmlOutput.replace("__ModifiedScope__",this.XML_MetricNames.MS[ModifiedScope||"X"]),xmlOutput=xmlOutput.replace("__ModifiedConfidentiality__",this.XML_MetricNames.MCIA[ModifiedConfidentiality||"X"]),xmlOutput=xmlOutput.replace("__ModifiedIntegrity__",this.XML_MetricNames.MCIA[ModifiedIntegrity||"X"]),xmlOutput=xmlOutput.replace("__ModifiedAvailability__",this.XML_MetricNames.MCIA[ModifiedAvailability||"X"]),xmlOutput=xmlOutput.replace("__EnvironmentalScore__",result.environmentalMetricScore),xmlOutput=xmlOutput.replace("__EnvironmentalSeverityRating__",result.environmentalSeverity),{success:!0,xmlString:xmlOutput}}generateXMLFromVector(vectorString){let metricValues={AV:void 0,AC:void 0,PR:void 0,UI:void 0,S:void 0,C:void 0,I:void 0,A:void 0,E:void 0,RL:void 0,RC:void 0,CR:void 0,IR:void 0,AR:void 0,MAV:void 0,MAC:void 0,MPR:void 0,MUI:void 0,MS:void 0,MC:void 0,MI:void 0,MA:void 0},badMetrics=[];if(!this.vectorStringRegex_30.test(vectorString))return{success:!1,errorType:"MalformedVectorString"};let metricNameValue=vectorString.substring(this.CVSSVersionIdentifier.length).split("/");for(let i in metricNameValue)if(metricNameValue.hasOwnProperty(i)){let singleMetric=metricNameValue[i].split(":");void 0===metricValues[singleMetric[0]]?metricValues[singleMetric[0]]=singleMetric[1]:badMetrics.push(singleMetric[0])}return badMetrics.length>0?{success:!1,errorType:"MultipleDefinitionsOfMetric",errorMetrics:badMetrics}:this.generateXMLFromMetrics(metricValues.AV,metricValues.AC,metricValues.PR,metricValues.UI,metricValues.S,metricValues.C,metricValues.I,metricValues.A,metricValues.E,metricValues.RL,metricValues.RC,metricValues.CR,metricValues.IR,metricValues.AR,metricValues.MAV,metricValues.MAC,metricValues.MPR,metricValues.MUI,metricValues.MS,metricValues.MC,metricValues.MI,metricValues.MA)}}